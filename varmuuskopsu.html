<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hakutyökalu</title>

    <link rel="stylesheet" href="styles.css">

    <!-- jquery käyttöön:
    -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

</head>

<body>

    <div id="sisältö">
        <h1>Kurssihaku</h1>



        <form >
            <!-- actioniin sivu, mihin tiedot submitistä menevät esim. "/action_page.php" -->
            <div class="Row">
                <div class="float-left">
                    <h3>Aihe</h3>
                    <select name="aihe" id="aihe">
                        <option value="aihe1">Asiakaslähtöisyys</option>
                        <option value="aihe2">Ohjaus- ja neuvontaosaaminen</option>
                        <option value="aihe3">Palvelujärjestelmäosaaminen</option>
                        <option value="aihe4">Lainsäädännön ja etiikan tuntemus</option>
                        <option value="aihe5">Tutkimus- ja kehittämisosaaminen</option>
                        <option value="aihe6">Robotiikka ja digitalisaatio</option>
                        <option value="aihe7">Vaikuttavuus-, kustannus- ja laatutietoisuus</option>
                        <option value="aihe8">Kestävän kehityksen mukainen ympäristöosaaminen</option>
                        <option value="aihe9">Viestintäosaaminen</option>
                        <option value="aihe10">Työntekijyysosaaminen</option>
                        <option value="aihe11">Monialainen yhteistoiminta</option>
                    </select>
                </div>
                <div class="float-left">
                    <h3>Korkeakoulu</h3>
                    <select name="koulu" id="koulu">
                        <option value="koulu1">Korkeakoulu1</option>
                        <option value="koulu2">Korkeakoulu2</option>
                        <option value="koulu3">Korkeakoulu3</option>
                        <option value="koulu4">Korkeakoulu4</option>
                        <option value="koulu5">Korkeakoulu5</option>
                        <option value="koulu6">Korkeakoulu6</option>
                        <option value="koulu7">Korkeakoulu7</option>
                        <option value="koulu8">Korkeakoulu8</option>
                        <option value="koulu9">Korkeakoulu9</option>
                        <option value="koulu10">Korkeakoulu10</option>
                        <option value="koulu11">Korkeakoulu11</option>
                    </select>
                </div>
                <div class="float-left">
                    <h3>Opetuskieli</h3>
                    <select name="kieli" id="kieli">
                        <option value="koulu1">Suomi </option>
                        <option value="koulu2">Ruotsi</option>
                        <option value="koulu3">Englanti</option>
                    </select>
                </div>
            </div>

            <br><br>

            <div class="nappiKeskelle">
                <input id="haeNappi" class="myButton" type="button" value="HAE OPINNOT">
            </div>

            <h2>Löydetyt opintojaksot</h2>

            <table id="data">
                <thead>
                    <tr>
                        <th>Opintojakson nimi</th>
                        <th>Oppilaitos</th>
                        <th>Opetuskieli</th>
                        <th>Opintopisteet</th>
                    </tr>
                </thead>

                <tbody id="tbody">
                    <!-- tbody:yn haetaan kurssit-->

                </tbody>

            </table>

        </form>

    </div>


    <script>
        // tietokannasta otettava korkeakoulut valikkoon (heti kun sivu latautuu!)
        // samoin geneeriset osa-alueet? kielet?

        $(document).ready(function () {

            //otetaan kiinni aihe mikä on valittu:
            $('#haeNappi').click(() => {
                
                var geneerinenAlue = document.getElementById("aihe");
                var aihe = geneerinenAlue.options[geneerinenAlue.selectedIndex].value; //antaa esim. "aihe5" eli Tutkimus...
                fetch(aihe);
            });

            fetch = (aihe) => {
                console.log(aihe);
                var valinta = "";
                if (aihe == "aihe1") {
                    valinta = "asiakaslahtoisyys";
                }
                if (aihe == "aihe2") {
                    valinta = "neuvontaosaaminen";
                }
                if (aihe == "aihe3") {
                    valinta = "palvelujarjestelmat";
                }
                if (aihe == "aihe4") {
                    valinta = "etiikka";
                }
                if (aihe == "aihe5") {
                    valinta = "tutkimusosaaminen";
                }
                if (aihe == "aihe6") {
                    valinta = "robotiikka";
                }
                if (aihe == "aihe7") {
                    valinta = "laatutietoisuus";
                }
                if (aihe == "aihe8") {
                    valinta = "kestavakehitys";
                }
                if (aihe == "aihe9") {
                    valinta = "viestintaosaaminen";
                }
                if (aihe == "aihe10") {
                    valinta = "tyontekijyysosaaminen";
                }
                if (aihe == "aihe11") {
                    valinta = "yhteistoiminta";
                }
                console.log(aihe);
                console.log(valinta);
                var osoiteUrl = 'http://127.0.0.1:5000/api/' + valinta;
                $.get({
                    url: osoiteUrl,
                    success: (result) => {
                        $("#data tbody").html("");
                        showResultInTable(result);
                    },
                    error: (e) => {
                        alert("Virhe: " + e); //e selkokieliseksi, miten?
                    }
                });
            }

        });

        //laitetaan tiedot taulukkoon:
        showResultInTable = (result) => {
            result.forEach(element => {
                let opintojaksot = "<tr><td>" + element.nimi + "</td>\n";
                opintojaksot += "<td>" + element.koulu + "</td>\n";
                opintojaksot += "<td>" + element.kieli + "</td>\n";
                opintojaksot += "<td>" + element.opintopisteet + "</td>\n"; 
                opintojaksot += "</tr>\n";
                $("#data tbody").append(opintojaksot);
            });
        }

    </script>


</body>

</html>